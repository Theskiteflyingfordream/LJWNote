# 基础

## 1、结构化数据、半结构化数据、非结构化数据 概念

## 2、lucene是什么

全文检索（将非结构化数据中的一部分信息提取出来，重新组织，使其变得有一定结构，然后对此有一定结构的数据进行搜索，从而达到搜索相对较快的目的。这就叫全文搜索；即先建立索引，再对索引进行搜索的过程。）**工具库**。与ES的区别是，ES是基于lucene实现的搜索引擎，是**独立服务化**的，具有高级的统计等功能

## 3、lucene架构

![image-20240818204401276](%E7%94%A8%E5%88%B0%E7%9A%84%E5%9B%BE%E7%89%87/image-20240818204401276.png)

（词法分析用于分词；语言处理作用比如单词转变为词根形式，”drove”到”drive”等）

## 4、lucene基本概念

![image-20240818211953499](%E7%94%A8%E5%88%B0%E7%9A%84%E5%9B%BE%E7%89%87/image-20240818211953499.png)

（1）索引：Lucene 索引库包含了搜索文本的所有内容，可以通过文件或文件流的方式存储在不同的[数据库](https://cloud.tencent.com/solution/database?from=20067&from_column=20067)或文件目录下。

（2）段：相当于小索引库，不同之间独立，搜索在不同段间执行，结果取并集；文档ID在段内连续且唯一；段过多时会进行合并。（分段的原因：防止频繁更新索引文件，代价大）

（3）文档：相当于MySQL的数据行

（4）域：相当于MySQL中的域（与MySQL不同的是，不同文档包含的域可以是不同的）

（5）词：lucene通过分词器将域中的字符串通过 词法分析 和 语言处理 后拆分成词

## 5、正向索引 和 倒排索引

（1）正向索引：文档ID -> 文档对应的域数据

（2）倒排索引：域对应的词 -> 文档ID

![image-20240818220815892](%E7%94%A8%E5%88%B0%E7%9A%84%E5%9B%BE%E7%89%87/image-20240818220815892.png)

索引中关键词是**按照字典序排序**的，从而支持二分法等快速定位到关键词；

上面三列数据分别保存在不同的文件中（其中关键词分为前缀FST索引和后缀，分别保存在tip和tim文件中，前者由内存加载）；第一列称为词典，第二列称为倒排表（其中每一行文档ID列表称为 posting lists）





## 6、lucene的API介绍







# 原理篇

## 1、词典的压缩数据结构 - FST

![image-20240819003539050](%E7%94%A8%E5%88%B0%E7%9A%84%E5%9B%BE%E7%89%87/image-20240819003539050.png)

lucene只会将tip文件（即term index）中的数据加载到内存中，在内存中并通过FST存储，如下（节点下的出度都是有序的）

![image-20240819003904236](%E7%94%A8%E5%88%B0%E7%9A%84%E5%9B%BE%E7%89%87/image-20240819003904236.png)

优点：共享前缀和后缀，极大压缩存储空间；

缺点：要求输入有序，难以更新







## 2、posting lists的压缩算法 - FOR压缩算法







## 3、针对posting lists做 and or 操作的 优化数据结构





# 问题：

1、FST是tip文件中读取到内存时才构建的，写文件时不构建？前缀中共享后缀？？？？

2、FST中的output到底起什么作用？存的是什么？

3、只有tip文件中的前缀才会构建FST？tip文件中存的是什么，为什么 马士兵课程 和 博客上的不一样，不是一棵树？